{% extends 'base.html' %}

{% block title %}Каталог{% endblock %}

{% block content %}
<h2>Каталог продуктов</h2>

<!-- Список категорий -->
<nav style="margin-bottom: 20px;">
    <strong>Категории:</strong>

    {% for category in categories %}
        <a href="{% url 'products:by_category' category.id %}"
           style="color: black; margin-right: 10px;
           {% if selected_category and selected_category.id == category.id %}font-weight:bold;{% endif %}">
           {{ category.name }}
        </a>
    {% endfor %}
</nav>

{% if selected_category %}
    <h3>Товары категории: {{ selected_category.name }}</h3>
    
    {# Здесь выводим описание категории #}
    {% if selected_category.description %}
        <p style="color:#555; margin-bottom:16px;">{{ selected_category.description }}</p>
    {% endif %}

    <ul style="list-style: none; padding: 0;">
        {% for product in products %}
            <li style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 12px;">
                <div style="display:flex; align-items:flex-start; gap:16px;">
                    {% if product.image %}
                        <div style="flex: 0 0 150px;">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" style="width:150px; height:auto; display:block; border-radius:6px;">
                        </div>
                    {% endif %}

                    <div style="flex:1;">
                        <strong style="font-size:1.05rem;">{{ product.name }}</strong>
                        <div style="color:#333; margin:6px 0;">{{ product.price }} ₽</div>
                        <p style="margin:0 0 8px; color:#555;">{{ product.description }}</p>

                        <form method="post" action="{% url 'orders:add_to_cart' product.id %}" style="display:flex; align-items:center; gap:8px;">
                            {% csrf_token %}
                            <label for="qty-{{ product.id }}" style="font-size:0.9rem;">Кол-во</label>
                            <input id="qty-{{ product.id }}" type="number" name="quantity" value="1" min="1"
                                   {% if product.stock %} max="{{ product.stock }}" {% endif %}
                                   style="width:72px; padding:6px; border-radius:4px; border:1px solid #ccc;">

                            {% if product.stock and product.stock > 0 %}
                                <button type="submit" style="padding:8px 12px; background:#28a745; color:white; border:none; border-radius:6px; cursor:pointer;">
                                    Добавить в корзину
                                </button>
                                <small style="margin-left:8px; color:#666;">В наличии: {{ product.stock }}</small>
                            {% else %}
                                <button type="button" disabled style="padding:8px 12px; background:#ccc; color:#666; border:none; border-radius:6px;">
                                    Нет в наличии
                                </button>
                            {% endif %}
                        </form>

                    </div>
                </div>
            </li>
        {% empty %}
            <li>Продуктов в этой категории пока нет.</li>
        {% endfor %}
    </ul>
{% else %}
    <p>Выберите категорию, чтобы увидеть товары.</p>
{% endif %}

{% endblock %}
